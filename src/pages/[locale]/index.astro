---
import Layout from '@/components/BaseLayout.astro';
import Project from '@/components/Project.astro';
import Image from '@astrojs/image';

import { getPlayCount, getFollowers } from '@/scripts/api';

import { loadTranslations } from '@/scripts/translate';
import Icon from 'astro-icon';
export { getStaticPaths } from '@/scripts/translate';

import { getBlogSlug } from '@/scripts/utils';

const { t, locale } = await loadTranslations(Astro);

const playCount = await getPlayCount();
const followers = await getFollowers();

const posts = await Astro.glob('../../../content/*.mdx');

const getPostDate = (post: typeof posts[number]) => new Date(post.frontmatter.date).valueOf();
const sortedPosts = posts.sort((a, b) => getPostDate(b) - getPostDate(a));
---

<Layout>
  <header class="my-20 md:my-24">
    <h1 class="font-bold text-gray-800 dark:text-gray-100 fluid-text-4xl font-hero !leading-[1]">{t.home.title}</h1>
    <p class="text-gray-600 fluid-text-lg !leading-[1.25] md:!leading-[1.4] dark:text-gray-200 my-7">
      {t.home.description}
      <a href="/about" class="font-semibold transition-colors text-sky-600 dark:text-sky-300 hover:text-sky-700 dark:hover:text-sky-200">
        {t.home.moreAbout}...
      </a>
    </p>
  </header>
  <section id="projects" class="my-14">
    <div class="flex justify-between xs:text-lg">
      <h2 class="font-bold text-gray-700 dark:text-gray-200">{t.home.projects}</h2>
      <a href="/projects" class="font-semibold transition-colors text-sky-600 dark:text-sky-300 hover:text-sky-700 dark:hover:text-sky-200">View more</a>
    </div>
    <div class="grid gap-4 my-8 md:gap-6 md:grid-cols-2">
      <Project name="bdh" stat={playCount} />
      <Project name="nidk" stat={followers} />
    </div>
  </section>
  <section id="projects" class="my-14">
    <div class="flex justify-between xs:text-lg">
      <h2 class="font-bold text-gray-700 dark:text-gray-200">Laatste artikelen</h2>
      <a href="/blog" class="font-semibold transition-colors text-sky-600 dark:text-sky-300 hover:text-sky-700 dark:hover:text-sky-200">View more</a>
    </div>
    <div class="grid gap-4 my-8 md:gap-6 md:grid-cols-2">
      {
        sortedPosts.map((post) => (
          <a href={`/blog/${getBlogSlug(post)}`} class="my-2 px-8 py-10 border-[3px] dark:border-gray-800 border-gray-200 border-dashed rounded-lg ">
            <h3 class="mb-2 font-semibold fluid-text-2xl md:fluid-text-xl font-hero">{post.frontmatter.title}</h3>
            <div class="flex gap-4 mb-1 text-lg text-gray-600 dark:text-gray-200">
              <span class="flex gap-2">
                <Icon name="tabler:calendar" width={20} /> {new Date(post.frontmatter.date).toLocaleDateString(locale, { dateStyle: 'medium' })}
              </span>
              <span class="flex gap-2">
                <Icon name="tabler:file-text" width={20} /> {Math.round(post.frontmatter.raw.length / 1200)} min.
              </span>
            </div>
          </a>
        ))
      }
    </div>
  </section>
</Layout>
