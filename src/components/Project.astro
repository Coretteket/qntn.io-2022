---
import Icon from 'astro-icon';
import { format, getImageSlug } from '@/scripts/utils';
import { getContentMeta, type MD } from '@/scripts/content';
import { getProjectStat } from '@/scripts/api';
import { getPicture } from '@astrojs/image';

export type Props = { project: MD<'project'> };
const { project } = Astro.props;
const { slug, path } = getContentMeta(project);

const images = await Astro.glob(`../../public/assets/project/*.png`);
const { image, sources } = await getPicture({
  src: `/assets/project/${getImageSlug(images, slug)}.png`,
  aspectRatio: 5 / 6,
  formats: ['avif', 'webp'],
  widths: [500],
});

const stat = await getProjectStat(slug);
---

<a
  title={project.frontmatter.title}
  id={slug}
  href={path}
  class="block group my-2 shadow dark:shadow-none rounded-lg w-full aspect-[5/6] max-h-[35rem] md:max-h-full relative overflow-hidden text-gray-50 bg-gray-900"
>
  <picture>
    {sources.map((source) => <source {...source} sizes="(min-width:1152px) 600px, 85vw" />)}
    <img {...image} class="object-cover w-full h-full transition-all duration-300 ease-out transform group-hover:scale-105 text-white/0 brightness-110" alt="" loading="lazy" />
  </picture>
  <div class="absolute top-0 w-full h-full p-10 md:max-lg:p-[4vw] bg-gradient-to-b from-black/60">
    <h2 class="text-3xl sm:text-[2.2rem] font-bold truncate md:pb-1 md:pt-2 md:text-4xl font-hero text-shadow">{project.frontmatter.title}</h2>
    <div
      class="max-w-full px-2.5 py-1 my-1.5 font-medium overflow-hidden text-lg truncate rounded shadow w-fit backdrop-blur-xl bg-white/10 border-l-[3px] border-white/50"
      title={`${format(stat, 'standard')} ${project.frontmatter.stat}`}
    >
      <b class="font-extrabold">{format(stat)}</b>
      <span>{project.frontmatter.stat}</span>
    </div>
  </div>
  <Icon name="icon-park-outline:arrow-right" width={36} class="absolute bottom-0 right-0 mx-8 my-6 w-9 xs:w-10 lg:mx-10" />
</a>
