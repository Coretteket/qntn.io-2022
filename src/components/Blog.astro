---
import Icon from 'astro-icon';
import { getContentMeta, type MD } from '@/scripts/content';
import { getPicture } from '@astrojs/image';
import { getImageSlug } from '@/scripts/utils';

export type Props = { post: MD<'blog'> };
const { post } = Astro.props as Props;
const { path, slug } = getContentMeta(post);

const images = await Astro.glob(`../../public/assets/blog/*.png`);
const { image, sources } = await getPicture({
  src: `/assets/blog/${getImageSlug(images, slug)}.png`,
  aspectRatio: 6 / 5,
  formats: ['avif', 'webp'],
  widths: [500],
});
---

<a href={path} class="block group my-2 shadow dark:shadow-none rounded-lg w-full aspect-[6/5] max-h-[35rem] md:max-h-full relative overflow-hidden text-gray-50 bg-gray-900">
  <picture>
    {sources.map((source) => <source {...source} sizes="(min-width:1152px) 600px, 85vw" />)}
    <img {...image} class="object-cover w-full h-full transition-all duration-300 ease-out transform group-hover:scale-105 text-white/0" alt="" loading="lazy" />
  </picture>
  <div class="absolute top-0 w-full h-full p-10 md:max-lg:p-[4vw] bg-gradient-to-b from-black/60">
    <h2 class="pb-1 text-3xl !leading-[1.1] font-hero font-semibold text-shadow">{post.frontmatter.title}</h2>
  </div>
  <Icon name="icon-park-outline:arrow-right" width={36} class="absolute bottom-0 right-0 mx-8 my-6 w-9 xs:w-10 lg:mx-10" />
</a>
